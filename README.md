# SQL

- Модель данный (model.sql)

- Необходимые ресурсы:
  
  - PostgreSQL
  
  - PgAdmin4

## SQL 1

- Изучим, как работает реляционная модель и как получить необходимые данные на основе базовых конструкций SQL.

## Задания:

### EX00 

- Реализовать запрос, который возвращает все имена и возраст людей из города «Казань».

### EX01

- Реализовать запрос, который возвращает имена и возраст всех женщин из города «Казань», отсортировать результаты по имени.

### EX02

- Реализовать два запроса, которые возвращают список пиццерий (название и рейтинг пиццерии) с рейтингом от 3,5 до 5 баллов (включая предельные баллы), упорядоченных по рейтингу пиццерии.

  - первый оператор выбора должен содержать знаки сравнения (<=, >=);

  - второй оператор выбора должен содержать ключевое слово BETWEEN.

### EX03

- Реализовать запрос, который возвращает идентификаторы лиц (без дубликатов), которые посетили пиццерии в период с 6 января 2022 г. по 9 января 2022 г. (включая все дни) или посетили пиццерии с идентификатором 2, отсортировать по убыванию идетификатора.

### EX04

- Реализовать запрос,который возвращает одно вычисляемое поле с именем `person_information` в одной строке, как описано в следующем примере:

`Anna (age:16,gender:'female',address:'Moscow')`

Отсортировать по вычисляемому столбцу в порядке возрастания.

### EX05

- Реализовать запрос, который возвращает имена людей (на основе внутреннего запроса в предложении SELECT), которые разместили заказы на меню с идентификаторами 13, 14 и 18, а дата заказов должна быть 7 января 2022 г.

### EX06

- Использовать запрос из [EX 05](#ex05) и добавим новый вычисляемый столбец (используйте имя столбца `check_name`) с оператором проверки, в предложении «SELECT»

    `if (person_name == 'Denis') then return true
        else return false`

### EX07

- Реализовать запрос, который возвращает идентификаторы человека, его имена и интервал возраста человека (задайте имя нового вычисляемого столбца как `interval_info`) на основе приведенного ниже псевдокода.

`
    if (age >= 10 and age <= 20) then return 'interval #1'
    else if (age > 20 and age < 24) then return 'interval #2'
    else return 'interval #3'
`

Отсортировать результат по столбцу `interval_info` в порядке возрастания.

### EX08

- Реализовать запрос, который возвращает все столбцы из таблицы person_order со строками, идентификатор которых представляет собой четное число. Результат должен быть упорядочен по возвращаемому идентификатору.

### EX09

- Реализовать запрос,  который возвращает имена людей и названия пиццерий на основе таблицы `person_visits` с датой посещения в период с 7 по 9 января 2022 г. (включая все дни) (на основе внутреннего запроса в таблице FROM).

    SELECT (...) AS person_name ,  -- this is an internal query in a main SELECT clause
            (...) AS pizzeria_name  -- this is an internal query in a main SELECT clause
    FROM (SELECT … FROM person_visits WHERE …) AS pv -- this is an internal query in a main FROM clause
    ORDER BY ...

Отсортировать по имени человека в порядке возрастания и по названию пиццерии в порядке убывания.

# SQL 2

- Изучим, как получить необходимые данные на основе конструкций множеств и простых соединений JOIN.

## Задания:

### EX00_2

- Реализовать запрос, который возвращает идентификатор меню и названия пиццы из таблицы «menu», а также идентификатор человека и имя человека из таблицы `person` в одном глобальном списке (с именами столбцов, как показано в примере ниже), упорядоченном по `object_id`. а затем по столбцам имя_объекта.

### EX01

- Измените оператор SQL из [EX 00](#ex00_2), удалив столбец `object_id`. Затем измените порядок по имени объекта для части данных из таблицы `person`, а затем из таблицы `menu`. Сохранить дубликаты!

### EX02

- Реализовать запрос, который возвращает уникальные названия пиццы из таблицы «menu» и сортирует их по столбцу `pizza_name` в порядке убывания. 

### EX03_2

- Реализовать запрос, который возвращает общие строки для атрибутов `order_date`, `person_id` из таблицы `person_orders` с одной стороны и `visit_date`, `person_id` из таблицы `person_visits` с другой стороны. Другими словами, найдем идентификаторы людей, которые посетили и заказали пиццу в тот же день. Отсортировать по `action_date` по возрастанию и `person_id` по убыванию.   

### EX04

- Реализовать запрос, который возвращает разницу (минус) значений столбца `person_id`, сохраняя при этом дубликаты между таблицами person_order и `person_visits` для `order_date` и `visit_date`, относящихся к 7 января 2022 года.

### EX05

- Реализовать запрос, который возвращает все возможные комбинации между таблицами `person` и `pizzeria`, и установите порядок столбцов идентификатора человека, а затем столбцов идентификатора пиццерии

### EX06

- Изменить запрос [EX 03](#ex03_2), чтобы он возвращал имена людей вместо идентификаторов людей, и изменим порядок по `action_date` в возрастанию, а затем по `person_name` по убыванию

### EX07_2

- Реализовать запрос, который возвращает дату заказа из таблицы `person_order` и соответствующее имя человека, который сделал заказ из таблицы `person`. Добавьте сортировку по обоим столбцам в порядке возрастания.

### EX08

- Переписать запрос [EX 07](#ex07_2), используя конструкцию NATURAL JOIN. Результат должен быть таким же, как в упражнении [EX 07](#ex07_2).

### EX09

- Реализовать два запроса, которые возвращают список пиццерий, которые не посещали люди, используя `IN` для первого и `EXISTS` для второго.

### EX10

- Реализовать запрос, который возвращает список имен людей, заказавших пиццу в 
соответствующей пиццерии. Отсортировать по `person_name`, `pizza_name`,
`pizzeria_name` в порядке возрастания.

# SQL3

- Изучим, как получить необходимые данные на основе различных структур JOIN.

## Задания:

### EX00

- Реализовать запрос, который возвращает список пиццерий с соответствующим значением рейтинга, которые еще не посещали люди.

### EX01_3

- Реализовать запрос, который возвращает пропущенные дни с 1 по 10 января 2022 г. (включая все дни) для посещений людьми с идентификаторами 1 или 2 (т. е. дни, пропущенные обоими). Отсортировать по дням посещения в порядке возрастания. 

### EX02

- Реализовать запрос, который будет возвращать весь список имен людей, которые посещали (или не посещали) пиццерии в период с 1 по 3 января 2022 года с одной стороны и весь список названий посещенных пиццерий ( или не посетил) на другой стороне. Обратите внимание на заменяющее значение '-' для значений `NULL` в столбцах `person_name` и `pizzeria_name`. Отсортировать по всем трем столбцам.

### EX03

- Изменить [EX 01](#ex01_3), используя шаблон CTE (Common Table Expression). Результат должен выглядеть аналогично упражнению [EX 01](#ex01_3).

### EX04

- Реализовать запрос, который найдет полную информацию обо всех возможных названиях и ценах пиццерий, чтобы получить пиццу с грибами или пепперони. Затем отсортируйте результат по названию пиццы и названию пиццерии. 

### EX05

- Реализовать запрос, который найдет имена всех женщин старше 25 лет и отсортируйте результат по имени. 

### EX06

- Реализовать запрос, который найдет все названия пицц (и соответствующие названия пиццерий с помощью таблицы «меню»), заказанные Денисом или Анной. Отсортируйте результат по обоим столбцам.  

### EX07

- Реализовать запрос, который найдет название пиццерии, которую Дмитрий посетил 8 января 2022 года и где мог съесть пиццу менее чем за 800 рублей.

### EX08

- Реализовать запрос, который найдет имена всех мужчин из Москвы или Самары, которые заказывают либо пепперони, либо пиццу с грибами (или и то, и другое). Отсортировать результат по именам людей в порядке убывания. 

### EX09

- Реализовать запрос, который найдет имена всех женщин, которые заказывали и пепперони, и сырную пиццу (в любое время и в любых пиццериях). Отсортировать по имени человека.

### EX10

- Реализовать запрос, который найдет имена людей, живущих по тому же адресу. Отсортировать по имени 1-го человека, имени 2-го человека и общему адресу. 

# SQL4

- Изучим, как изменять данные на основе языка DML.

## Задания:

### EX00

- Реализовать запрос, который возвращает список названий пицц, цен на пиццу, названий пиццерий и дат посещения Кейт и для цен от 800 до 1000 рублей. Отсортировать по пицце, цене и названию пиццерии. 

### EX01_4

- Реализовать запрос, который найдет все идентификаторы меню, которые никем не заказаны. Результат должен быть отсортирован по идентификатору

### EX02

Дополнить запрос из [EX01](#ex01_4) и вывести названия пицц из пиццерии, которые никто не заказывал, включая соответствующие цены. Результат должен быть отсортирован по названию и цене пиццы.

### EX03

- Реализовать запрос, который найдет пиццерии, которые чаще посещают женщины или мужчины. Сохраняйте дубликаты для любых операторов SQL с наборами (конструкции `UNION ALL`, `EXCEPT ALL`, `INTERSECT ALL`). Отсортировать результат по названию пиццерии. 

### EX04

- Найти объединение пиццерий, которые заказывают как женщины, так и мужчины. Другими словами, вам необходимо найти набор названий пиццерий, которые заказывали только женщины, и провести операцию «UNION» с набором названий пиццерий, которые заказывали только мужчины. Отсортировать результат по названию пиццерии.

### EX05

- Реализовать запрос, который возвращает список пиццерий, которые `Andrey` посетил, но не сделал заказ. Отсортировать по названию пиццерии. 

### EX06

- Реализовать запрос, который найдет одинаковые названия пицц по одинаковой цене, но из разных пиццерий. Отсортировать по названию пиццы.

### EX07

- Необходимо добавить новую пиццу с названием `greek pizza` (используйте id=19) по цене 800 рублей в ресторане `Dominos` (pizzeria_id=2).

### EX08

- Необходимо добавить новую пиццу с названием `sicilian pizza` (идентификатор которой должен рассчитываться по формуле «максимальное значение id + 1») по цене 900 рублей в ресторане «Доминос» (для получения идентификатора используйте внутренний запрос пиццерии).

### EX09

- Необходимо добавить новые посещения ресторана Domino's `Denis` и `Irina` 24 февраля 2022 года.

### EX10

- Необходимо добавить новые аказы от `Denis` и `Irina` 24 февраля 2022 года на новое меню `sicilian pizza` .

### EX11

- Изменить цену `greek pizza` на -10% от текущей стоимости.

### EX12_4

- Необходимо добавить новые заказы всех лиц на «Греческую пиццу» 25 февраля 2022 года.

### EX13

- Реализовать два запроса, которые удаляют все новые заказы из упражнения [EX12](#ex12_4 )на основе даты заказа и `greek pizza` и `menu`.

# SQL5

- Изучим, как использовать виртуальное представление и физический снимок данных.

## Задания:

### EX00_5

- Создать 2 представления базы данных (с атрибутами, аналогичными исходной таблице) на основе простой фильтрации по полу людей. Задайте соответствующие имена для представлений базы данных: `v_persons_female` и `v_persons_male`.

### EX01

- Используя два предсьавдения из [EX00](#ex00_5), написать запрос для того, чтобы получить имена женщин и мужчин в одном списке. Отсортировать по именам.

### EX02

- Создать представление базы данных (с именем `v_generated_dates`), которое должно «хранить» сгенерированные даты с 1 по 31 января 2022 года в типе DATE. Отсортировать по дате.

### EX03

- Реализовать запрос, который возвращает пропущенные дни для посещений людей в январе 2022 года. Использовать для этой задачи представление `v_generated_dates` и отсортировать результат по столбцу `missing_date`. 

### EX04

- Реализовать запрос, который будет уловдетворять формуле `(R - S)∪(S - R)`. Где R — это таблица `person_visits` с фильтром до 2 января 2022 г., S — это также таблица `person_visits`, но с другим фильтром до 6 января 2022 г. Пожалуйста, проведите расчеты с наборами в столбце `person_id`, и это В результате столбец будет один. Отсортировать результат по столбцу `person_id` и представьте окончательный SQL в представлении базы данных `v_symmetric_union`

### EX05

- Создать представление базы данных `v_price_with_discount`, которое возвращает заказы человека с именем человека, названием пиццы, реальной ценой и рассчитанным столбцом `discount_price` (с примененной скидкой 10 % и удовлетворяющей формуле `price - price*0,1`). Отсортировать результат по именам людей и названиям пицц и преобразуйте столбец `discount_price` в целочисленный тип.

### EX06-5

- Создать материализованное представление `mv_dmitriy_visits_and_eats` (с включенными данными) на основе оператора SQL, который находит название пиццерии, которую Дмитрий посетил 8 января 2022 года и мог есть пиццу менее чем за 800 рублей (этот SQL запрос [EX07](#ex07_2)).

### EX07

- Необходимо обновить анные в нашем материализованном представлении `mv_dmitriy_visits_and_eats` из [EX06](#ex06_5). Перед этим действием создайте еще одно посещение Дмитрия, которое удовлетворяет предложению SQL материализованного представления, за исключением пиццерии, которую мы видим в результате [EX06](#ex06_5) .
После добавления нового посещения обновите состояние данных для `mv_dmitriy_visits_and_eats`.

### EX08

- Удалить все представления